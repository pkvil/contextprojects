\startenvironment nio-environment

\mainlanguage[sv]

%%
%% F O N T S
%%


\setupbodyfont[arnopro,12pt]
\definebodyfontenvironment[10pt][interlinespace=12pt]
\definebodyfontenvironment[11pt][interlinespace=15pt]
\definebodyfontenvironment[12pt][interlinespace=15pt]
\definebodyfontenvironment[13pt][interlinespace=15pt]
\definesymbol[leaf][\fontchar{leaf}] % by name

%%
%% P A P E R   A N D   P A G E   S I Z E
%%

\definepapersize[mypage][width=6in, height=9in]
\definepapersize[mypage2][width=14cm, height=21cm]
\setuppapersize[mypage2][mypage2]

%%
%% P A G E   L A Y O U T
%%

\setuplayout[
    location={middle,left,doublesided},
    grid=yes,
    marking=on,
   % TOP TO BOTTOM    
    topspace=12mm,
    header=1\baselineskip,
    headerdistance=1\baselineskip,
    height=35\baselineskip\relax,
    footerdistance=1\baselineskip,
    footer=2\lineheight,
   % INNER TO OUTER
    backspace=15mm,
    leftmargin=64pt,
    leftmargindistance=9pt,
    width=110mm,
    rightmargin=64pt,
    rightmargindistance=16pt,
]



\setuppagenumbering[alternative=doublesided, location=,]

%%
%% S E C T I O N I N G
%%

\definepagebreak[emptypagebreak][yes,header,footer,right]

% FRONTMATTER

\startsectionblockenvironment[frontpart]
 % \setcounter[userpage][1]
 % \setupuserpagenumber [numberconversion=romannumerals]
\setupheadertexts[] % recto outer
                 [] % recto inner
                 [] % verso inner
                 [] % verso outer
\setupfootertexts[] % recto outer
                 [] % recto inner
                 [] % verso inner
                 [] % verso outer
\stopsectionblockenvironment

% BODYMATTER

\startsectionblockenvironment[bodypart]
    \setcounter[userpage][1]
\stopsectionblockenvironment

% CHAPTER

\setuphead[chapter][%
    page=emptypagebreak,
    number=no,
    before={\startlinecorrection\blank[2*line,force]},
    after={\stoplinecorrection\blank[3*line,force]},
    header=empty,
    alternative=middle,
    style={\tfc \feature[+][liningfigures]},
    textcommand={\kerncharacters[0.17]},
    deeptextcommand=\WORD,
]

%%
%% P A R A G R A P H
%%

\setupindenting[no,small] % indent paragraphs
\setupwhitespace[line] % whitespace between paragraphs

\setupspacing[packed] % French spacing

\setupitaliccorrection[text]

\setupalign[hanging,hz,verytolerant] % microtypography, allow some stretching

%%
%% H E A D E R S   &   F O O T E R S
%%


\setupheadertexts[\hfill{\kerncharacters[0.17]\sc \getmarking[chapter]}\hfill] %recto outer
                 [] % recto inner
                 [] % verso inner
                 [\hfill{\kerncharacters[0.17]\sc Nio noveller i elfte timmen}\hfill] % verso outer

\setupfootertexts[\hfill \pagenumber \hfill] % recto outer
                 [] % recto inner
                 [] % verso inner
                 [\hfill \pagenumber \hfill] % verso outer

%%
%% M I S C
%%

\setupexternalfigures[directory=images]

%%
%% D R O P   C A P S
%%

% M

\define[1]\dropcapM{%
    \definefont[capfont][file:ArnoPro-LightDisplay at 54pt]
    \definefont[quotefont][Serif at 16pt]
    \noindent\kern -0.08em
    {\capfont M}
    \vskip-4\baselineskip
    \dimen1=4.05em
    \dimen2=4.15em
    \dimen3=4.15em
    \parshape 4
        \dimen1 \dimexpr\hsize-\dimen1
        \dimen2 \dimexpr\hsize-\dimen2       
        \dimen3 \dimexpr\hsize-\dimen3     
        0pc \hsize                                   
    \noindent{\feature[-][liga]\kerncharacters[0.14]\sc #1}%            
}

% D

\define[1]\dropcapD{%
    \definefont[capfont][file:ArnoPro-LightDisplay at 54pt]
    \definefont[quotefont][Serif at 16pt]
    \noindent\kern -0.16em
    {\capfont D}
    \vskip-4\baselineskip
    \dimen1=3.1em
    \dimen2=3.5em
    \dimen3=3.2em
    \parshape 4
        \dimen1 \dimexpr\hsize-\dimen1
        \dimen2 \dimexpr\hsize-\dimen2       
        \dimen3 \dimexpr\hsize-\dimen3     
        0pc \hsize                                   
    \noindent{\feature[-][liga]\kerncharacters[0.14]\sc #1}%            
}

%%
%% V I S U A L   D E B U G G I N G
%%

%\showframe
%\showboxes
%\showgrid

%\enabletrackers[visualizers.justification]

%\adaptlayout[7][lines=+1]
%\adaptlayout[11][lines=+1]
%\adaptlayout[14][lines=+1]


\stopenvironment
